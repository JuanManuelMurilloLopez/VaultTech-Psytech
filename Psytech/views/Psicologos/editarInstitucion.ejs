<!DOCTYPE html>
<html lang="es">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar instituciones</title>
    <!-- Bootstrap CSS -->
    <link href=
    "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet">
    <!-- Link css -->
    <link rel="stylesheet" href="/css/psicologos/editarInstitucion.css">
    <!-- CSS navside -->
    <link rel="stylesheet" href="/css/includeCss/_navsidePsicologo.css">
    <!-- CSS cerrar sesión -->
    <link rel="stylesheet" href="/css/includeCss/_buttonCerrarSesion.css">
</head>


<body>

    <div class="main">
        <!-- Navside -->
        <%- include('../includes/_navsidePsicologo.ejs') %>
        <div class="container">

            <!-- Boton de cerrar sesión -->
            <%- include('../includes/_buttonCerrarSesion.ejs') %>
            <span><%= error %></span>
            <h1 class="text-center">EDITAR INSTITUCIÓN</h1>
            <hr>

            <form method="POST">
                <!-- Campo Nombre --> 
                <div class="form-floating mb-3 mt-5">
                    <input type="" class="form-control" id="" value="<%= institucion.nombreInstitucion %>" name="nombreInstitucion" required>
                    <label for="">Nombre</label>
                </div>
            
                <!-- Campo Tipo Institución -->
                <select class="form-select" aria-label="Default select example" name="idTipoInstitucion" value="<%= institucion.idTipoInstitucion %>">
                    <% for(tipoInstitucion of tiposInstitucion) { %>
                        <option value="<%= tipoInstitucion.idTipoInstitucion %>"><%= tipoInstitucion.nombreTipoInstitucion %></option>
                    <% } %>
                </select>
            
                <div class="mb-3 mt-5">
                    <h4 class="mb-3">Estatus:</h4>
                    <div class="d-flex gap-2 align-items-center">
                      <% if (institucion.estatusInstitucion === 1) { %>
                        <button type="button" id="toggleEstatusBtn" class="btn btn-danger">Desactivar</button>
                      <% } else { %>
                        <button type="button" id="toggleEstatusBtn" class="btn btn-info">Activar</button>
                      <% } %>
                  
                      <input type="hidden" id="estatusInstitucion" name="estatusInstitucion" value="<%= institucion.estatusInstitucion === 1 ? '1' : '0' %>">
                    </div>
                  </div>

                <br>
    
                <div>
                  <h4 class="mb-3">Eliminar Institución</h4>
                  <button type="button" class="btn btn-danger" onclick="mostrarModal('<%= idInstitucion %>')">ELIMINAR</button>
                  <br> <br>
                </div>
                <!-- Botones de navegación "Regresar y Guardar" -->

                <div class="d-flex justify-content-between mb-4">
                  <button type="button" class="btn btn-color--third"
                  onclick="window.location.href=
                  '/psicologo/catalogo-instituciones'"
                  >Regresar</button>
      
                  <button type="submit" class="btn btn-color--secondary"
                  onclick="confirm('¿Está seguro de guardar los cambios?')"
                  >Guardar</button>
                </div>
            </form>
  
            <!-- Modal -->
            <div id="modalEliminar" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div style="background:white; padding:20px; max-width:500px; margin:100px auto; border-radius:8px; position:relative;">
                    <h4>Confirmar eliminación</h4>
                    <p>Escribe <strong>Eliminar</strong> para confirmar esta acción. Esta acción no se puede deshacer.</p>
                    <input type="text" id="confirmarTexto" class="form-control" placeholder="Escribe 'Eliminar'" oninput="verificarTextoConfirmacion()" />
                    <div class="mt-3 d-flex justify-content-end">
                        <button onclick="cerrarModal()" class="btn btn-secondary me-2">Cancelar</button>
                        <form id="formEliminar" method="POST">
                            <button type="submit" class="btn btn-danger" id="btnConfirmarEliminar" disabled>Confirmar eliminación</button>
                        </form>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
          const toggleBtn = document.getElementById('toggleEstatusBtn');
          const estatusInput = document.getElementById('estatusInstitucion');
        
          toggleBtn.addEventListener('click', function() {
            const estaActiva = estatusInput.value === '1';
        
            estatusInput.value = estaActiva ? '0' : '1';
        
            toggleBtn.textContent = estaActiva ? 'Activar' : 'Desactivar';
            toggleBtn.classList.toggle('btn-danger', !estaActiva);
            toggleBtn.classList.toggle('btn-info', estaActiva);
          });
        });
    </script>

    <!-- Bootstrap JS -->
    <script src=
    "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>

  <script>

      let rutaForm = "";

      function mostrarModal(idInstitucion) {
          rutaForm = `/psicologo/instituciones/eliminar/${idInstitucion}`;
          document.getElementById("formEliminar").action = rutaForm;
          document.getElementById("confirmarTexto").value = "";
          document.getElementById("btnConfirmarEliminar").disabled = true;
          document.getElementById("modalEliminar").style.display = "block";
      }

      function cerrarModal() {
          document.getElementById("modalEliminar").style.display = "none";
      }

      function verificarTextoConfirmacion() {
          const texto = document.getElementById("confirmarTexto").value.trim();
          document.getElementById("btnConfirmarEliminar").disabled = (texto !== "Eliminar");
      }
  </script>

</body>
