<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Análisis Hartman</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- CSS personalizado -->
  <link rel="stylesheet" href="/css/psicologos/analisisHartman.css" />
  <link rel="stylesheet" href="/css/includeCss/_navsidePsicologo.css">
  <link rel="stylesheet" href="/css/includeCss/_buttonCerrarSesion.css">
    
  <!-- CSS para imprimir -->
  <link rel="stylesheet" href="/css/psicologos/analisisHartman.print.css" media="print">

</head>

<body class="d-flex">
    <div class="main d-flex w-100">
        <%- include('../includes/_navsidePsicologo.ejs') %>

        <div class="container py-4">
            <%- include('../includes/_buttonCerrarSesion.ejs') %>

            <!-- Encabezado principal -->
            <div class="text-center mb-5">
                <h2 class="fw-bold">Análisis Prueba Hartman</h2>
                <h4 class="fw-semibold">
                    <%= analisisHartman[0].nombreAspirante %>
                    <%= analisisHartman[0].apellidoPaternoAspirante %>
                    <%= analisisHartman[0].apellidoMaternoAspirante %>
                </h4>
            </div>
            <!-- Tabla de respuestas -->
            <div class="row mb-5">
                <!-- Tabla Parte 1: Frases -->
                <div class="col-md-6">
                    <h5 class="fw-semibold mb-3">Parte 1: Frases</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm align-middle text-center table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Orden</th>
                                    <th>Respuesta</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for(let i = 0; i < respuestas.fase1.length; i++) { %>
                                    <tr>
                                        <td><%= i + 1 %></td>
                                        <td><%= respuestas.fase1[i].idPreguntaHartman %></td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabla Parte 2: Citas -->
                <div class="col-md-6">
                    <h5 class="fw-semibold mb-3">Parte 2: Citas</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm align-middle text-center table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Orden</th>
                                    <th>Respuesta</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for(let i = 0; i < respuestas.fase2.length; i++) { %>
                                    <tr>
                                        <td><%= i + 1 %></td>
                                        <td><%= respuestas.fase2[i].idPreguntaHartman - 18 %></td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
             
            <!-- Card con datos y grafica -->
            <div class="card shadow-sm mb-5 d-none">
                <div class="card-body">
                    <div class="chart-container">
                        <div class="text-center mb-3">
                            <p class="analisisHartman">
                                <strong>Desarrollo de personalidad:</strong> 
                                <%= ((1 - (analisisHartman[0].fraseIntGeneral / analisisHartman[0].fraseDif)) * 100).toFixed(2) %>%
                            </p>
                            <p class="analisisHartman">
                                <strong>Falta Madurar:</strong> 
                                <%= ((analisisHartman[0].fraseIntGeneral / analisisHartman[0].fraseDif) * 100).toFixed(2) %>%
                            </p>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="chart"></canvas>
                        </div>
                    </div>

                    <!-- Mundo Interno -->
                    <h5 class="fw-semibold">Mundo Interno - Citas</h5>
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered table-sm align-middle text-center table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Dim I</th><th>Dim E</th><th>Dim S</th><th>Dim General</th><th>Dim %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= analisisHartman[0].citaDimI %></td>
                                    <td><%= analisisHartman[0].citaDimE %></td>
                                    <td><%= analisisHartman[0].citaDimS %></td>
                                    <td><%= analisisHartman[0].citaDimGeneral %></td>
                                    <td><%= analisisHartman[0].citaDimPorcentaje %></td>
                                </tr>
                            </tbody>
                            <thead class="table-primary">
                                <tr>
                                    <th>Int I</th><th>Int E</th><th>Int S</th><th>Int General</th><th>Int %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= analisisHartman[0].citaIntI %></td>
                                    <td><%= analisisHartman[0].citaIntE %></td>
                                    <td><%= analisisHartman[0].citaIntS %></td>
                                    <td><%= analisisHartman[0].citaIntGeneral %></td>
                                    <td><%= analisisHartman[0].citaIntPorcentaje %></td>
                                </tr>
                            </tbody>
                            <thead class="table-secondary">
                                <tr>
                                    <th>D.I</th><th>DIF</th><th>DIS</th><th>Sq1</th><th>Sq2</th><th>Ai%</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= analisisHartman[0].citaDi %></td>
                                    <td><%= analisisHartman[0].citaDif %></td>
                                    <td><%= analisisHartman[0].citaDIS %></td>
                                    <td><%= analisisHartman[0].citaSQ1 %></td>
                                    <td><%= analisisHartman[0].citaSQ2 %></td>
                                    <td><%= analisisHartman[0].citaAiPorcentaje %></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Mundo Externo -->
                    <h5 class="fw-semibold">Mundo Externo - Frases</h5>
                    <div class="table-responsive mb-4">
                        <table class="table table-bordered table-sm align-middle text-center table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Dim I</th><th>Dim E</th><th>Dim S</th><th>Dim General</th><th>Dim %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= analisisHartman[0].fraseDimI %></td>
                                    <td><%= analisisHartman[0].fraseDimE %></td>
                                    <td><%= analisisHartman[0].fraseDimS %></td>
                                    <td><%= analisisHartman[0].fraseDimGeneral %></td>
                                    <td><%= analisisHartman[0].fraseDimPorcentaje %></td>
                                </tr>
                            </tbody>
                            <thead class="table-primary">
                                <tr>
                                    <th>Int I</th><th>Int E</th><th>Int S</th><th>Int General</th><th>Int %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= analisisHartman[0].fraseIntI %></td>
                                    <td><%= analisisHartman[0].fraseIntE %></td>
                                    <td><%= analisisHartman[0].fraseIntS %></td>
                                    <td><%= analisisHartman[0].fraseIntGeneral %></td>
                                    <td><%= analisisHartman[0].fraseIntPorcentaje %></td>
                                </tr>
                            </tbody>
                            <thead class="table-secondary">
                                <tr>
                                    <th>DiF</th><th>D.I</th><th>DIS</th><th>Vq1</th><th>Vq2</th><th>Ai%</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><%= analisisHartman[0].fraseDif %></td>
                                    <td><%= analisisHartman[0].fraseDi %></td>
                                    <td><%= analisisHartman[0].fraseDIS %></td>
                                    <td><%= analisisHartman[0].fraseVQ1 %></td>
                                    <td><%= analisisHartman[0].fraseVQ2 %></td>
                                    <td><%= analisisHartman[0].fraseAiPorcentaje %></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Equilibrio -->
                    <h5 class="fw-semibold">Equilibrio</h5>
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm align-middle text-center table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Área</th><th>Bqr1</th><th>Bqr2</th><th>Bqa1</th><th>Bqa2</th><th>Cq1</th><th>Cq2</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Equilibrio</strong></td>
                                    <td><%= analisisHartman[0].BQr1.toFixed(2) %></td>
                                    <td><%= analisisHartman[0].BQr2.toFixed(2) %></td>
                                    <td><%= analisisHartman[0].BQa1.toFixed(2) %></td>
                                    <td><%= analisisHartman[0].BQa2.toFixed(2) %></td>
                                    <td><%= analisisHartman[0].CQ1.toFixed(2) %></td>
                                    <td><%= analisisHartman[0].CQ2.toFixed(2) %></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Boton regresar -->
            <div class="text-center mt-4 mb-5">
                <a class="btn btn-color--third" href="/psicologo/aspirantes/<%= idAspirante %>/<%= idGrupo %>/<%= idInstitucion %>">
                    Regresar
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/graficaHartman.js"></script>
    <script>
        const hartmanData = {
          MundoInterno: {
            DimI: <%= datos.MundoInterno.DimI %>,
            DimE: <%= datos.MundoInterno.DimE %>,
            DimS: <%= datos.MundoInterno.DimS %>,
            DiF: <%= datos.MundoInterno.DiF %>,
            DimGeneral: <%= datos.MundoInterno.DimGeneral %>,
            DimPorcentaje: <%= datos.MundoInterno.DimPorcentaje %>,
            IntI: <%= datos.MundoInterno.IntI %>,
            IntE: <%= datos.MundoInterno.IntE %>,
            IntS: <%= datos.MundoInterno.IntS %>,
            IntGeneral: <%= datos.MundoInterno.IntGeneral %>,
            IntPorcentaje: <%= datos.MundoInterno.IntPorcentaje %>,
            Di: <%= datos.MundoInterno.Di %>,
            Dis: <%= datos.MundoInterno.Dis %>,
            Sq1: <%= datos.MundoInterno.Sq1 %>,
            Sq2: <%= datos.MundoInterno.Sq2 %>
          },
          MundoExterno: {
            DimI: <%= datos.MundoExterno.DimI %>,
            DimE: <%= datos.MundoExterno.DimE %>,
            DimS: <%= datos.MundoExterno.DimS %>,
            DiF: <%= datos.MundoExterno.DiF %>,
            DimGeneral: <%= datos.MundoExterno.DimGeneral %>,
            DimPorcentaje: <%= datos.MundoExterno.DimPorcentaje %>,
            IntI: <%= datos.MundoExterno.IntI %>,
            IntE: <%= datos.MundoExterno.IntE %>,
            IntS: <%= datos.MundoExterno.IntS %>,
            IntGeneral: <%= datos.MundoExterno.IntGeneral %>,
            IntPorcentaje: <%= datos.MundoExterno.IntPorcentaje %>,
            Di: <%= datos.MundoExterno.Di %>,
            Dis: <%= datos.MundoExterno.Dis %>,
            Vq1: <%= datos.MundoExterno.Vq1 %>,
            Vq2: <%= datos.MundoExterno.Vq2 %>
          },
          Equilibrio: {
            Bqr1: <%= datos.Equilibrio.Bqr1 %>,
            Bqr2: <%= datos.Equilibrio.Bqr2 %>,
            Bqa1: <%= datos.Equilibrio.Bqa1 %>,
            Bqa2: <%= datos.Equilibrio.Bqa2 %>,
            Cq1: <%= datos.Equilibrio.Cq1 %>,
            Cq2: <%= datos.Equilibrio.Cq2 %>
          }
        };
    </script>

    <!-- Script para boton de imprimir -->
    <script>
            document.addEventListener('DOMContentLoaded', function() {
        // Definir estilos del boton
        const buttonStyles = {
            className: 'btn btn-color--secondary',
            innerHTML: 'Imprimir Análisis',
            style: {
            padding: '6px 24px',
            fontSize: '16px'
            }
        };
        
        // Buscar el contenedor
        let container = document.querySelector('.boton-container');
        
        if (!container) {
            // Si no existe, crear uno nuevo
            container = document.createElement('div');
            container.className = 'boton-container';
            
            // Estilos para el nuevo contenedor
            Object.assign(container.style, {
            display: 'flex',
            justifyContent: 'flex-end',
            marginTop: '60px',
            marginBottom: '40px',
            width: '100%'
            });
            
            // Insertar en la pag
            const mainContainer = document.querySelector('.container');
            if (mainContainer) {
            mainContainer.appendChild(container);
            }
        } else {
            // Ajustar el contenedor que existe
            Object.assign(container.style, {
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            width: '100%'
            });
        }
        
        // Crear boton de imprimir
        const printButton = document.createElement('button');
        
        // Poner estilos y propiedades
        printButton.className = buttonStyles.className;
        printButton.innerHTML = buttonStyles.innerHTML;
        Object.assign(printButton.style, buttonStyles.style);
        
        // Poner funcion de imprimir
        printButton.addEventListener('click', () => window.print());
        
        // Agregar al contenedor
        container.appendChild(printButton);
        });
    </script>
</body>
</html>